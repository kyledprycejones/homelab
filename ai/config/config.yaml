# Orchestrator v7 Configuration
# This is the canonical source of truth for protected files and allowed paths.

# v7 Protected Files: Patches CANNOT modify these files
# Both bootstrap_loop.sh and drift_engine.py read from this list
protected_files:
  - docs/master_memo.txt
  - docs/master_memo.md
  - ai/context_map.yaml
  - ai/bootstrap_loop.sh
  - ai/drift_engine.py
  - infrastructure/proxmox/wipe_proxmox.sh

# v7 Allowed Paths: Patches CAN modify files under these directories
allowed_paths:
  - ai/
  - infrastructure/
  - cluster/
  - apps/
  - docs/
  - config/

# Stage 1 orchestrator persona routing
personas:
  executor:
    description: "Level-1 worker; runs commands and small file edits."
    primary_model: executor_local
    fallback_model: executor_cloud
    max_context_tokens: 1024
    max_output_tokens: 256
    allowed_paths:
      - infrastructure/
      - cluster/
      - config/
      - scripts/
      - docs/
      - ai/
    forbidden_paths:
      - .git/
      - infrastructure/proxmox/k3s/
      - /etc/
      - /var/
      - config/env/
    max_retries: 3

  planner:
    description: "Planner/designer; sets repo contracts and task strategies."
    primary_model: planner_default
    max_context_tokens: 8192
    max_output_tokens: 2048
    allowed_paths:
      - docs/
      - ai/
    auto_approve_paths:
      - docs/
      - ai/
    can_edit_code: false
    can_edit_backlog_structure: true
    can_edit_persona_config: true

routing:
  default_persona: executor

  escalation_rules:
    - from: executor
      to: planner
      on:
        failure_count: 3
      create_backlog_task: true
      backlog_type: recovery_plan
