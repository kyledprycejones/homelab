- id: S1-PREFLIGHT-HOST
  stage: 1
  persona: executor
  summary: 'PREFLIGHT: verify control-plane environment'
  detail: Run ai/preflight/preflight_tools.sh to confirm required tools and connectivity
    before Stage 1.
  target: ai/preflight/preflight_tools.sh
  status: success
  attempts: 0
  max_attempts: 1
  depends_on: []
  note: Executor succeeded
- id: S1-LINT-BACKLOG
  stage: 1
  persona: executor
  summary: 'LINT: validate backlog and targets'
  detail: Execute ai/scripts/lint_backlog.sh to confirm backlog schema, task ids,
    and target paths before apply.
  target: ai/scripts/lint_backlog.sh
  status: success
  attempts: 0
  max_attempts: 1
  depends_on:
  - S1-PREFLIGHT-HOST
  note: Executor succeeded
- id: S1-PROXMOX-INVENTORY
  stage: 1
  persona: executor
  summary: 'INVENTORY: snapshot Proxmox VMs'
  detail: Capture qm list --full output on the Proxmox host to feed the provisioning
    workflow.
  target: ai/scripts/reconcile_proxmox_inventory.sh
  status: blocked
  attempts: 1
  max_attempts: 1
  depends_on:
  - S1-PREFLIGHT-HOST
  note: Blocked after 1 failures (recovery queued)
  metadata:
    blocked_mode: recovery
  summary: 'PROVISION: ensure Ubuntu Server + k3s VMs exist'
  detail: Run infrastructure/proxmox/provision_vms.sh to create the control-plane
    and worker VMs with the Ubuntu cloud image, static IPs, and SSH key configured.
  target: infrastructure/proxmox/provision_vms.sh
  status: pending
  attempts: 0
  max_attempts: 1
  depends_on:
  - S1-PROXMOX-INVENTORY
  note: ''
- id: S1-RESOLVE-CTRL_IP
  stage: 1
  persona: executor
  summary: 'RESOLVE: load controller IP'
  detail: Ensure proxmox_inventory.json is present and export controller_ip/node_ips
    before bootstrapping.
  target: ai/scripts/resolve_ctrl_ip.sh
  status: pending
  attempts: 0
  max_attempts: 1
  depends_on:
  - S1-PROVISION-VMS
  note: ''
- id: S1-APPLY-BOOTSTRAP
  stage: 1
  persona: executor
  summary: 'APPLY: bootstrap infrastructure'
  detail: Run infrastructure/proxmox/cluster_bootstrap.sh to apply the desired state
    for Stage 1.
  target: infrastructure/proxmox/cluster_bootstrap.sh
  status: pending
  attempts: 0
  max_attempts: 3
  depends_on:
  - S1-RESOLVE-CTRL_IP
  note: ''
- id: S1-VALIDATE-BOOTSTRAP
  stage: 1
  persona: executor
  summary: 'VALIDATE: verify bootstrap results'
  detail: Confirm cluster state after apply using infrastructure/proxmox/check_cluster.sh.
  target: infrastructure/proxmox/check_cluster.sh
  status: pending
  attempts: 0
  max_attempts: 3
  depends_on:
  - S1-APPLY-BOOTSTRAP
  note: ''
- id: S1-PROXMOX-INVENTORY-PLANNER-RECOVERY
  stage: 1
  persona: planner
  summary: Planner recovery for S1-PROXMOX-INVENTORY
  detail: Executor exhausted retries with classification=ERR_UNKNOWN; planner must
    read ai/state/last_error.json and synthesize recovery tasks (RECONCILE, DELETE/RESET,
    APPLY, VALIDATE).
  target: docs/orchestrator_v7_2.txt
  attempts: 0
  max_attempts: 1
  status: success
  note: Planner added tasks
  depends_on:
  - S1-PROXMOX-INVENTORY
- id: S1-PROXMOX-INVENTORY-RECONCILE
  stage: 1
  persona: executor
  summary: 'RECONCILE: observe state for S1-PROXMOX-INVENTORY'
  detail: Read-only discovery to document current state after failure of S1-PROXMOX-INVENTORY
  target: infrastructure/proxmox/check_cluster.sh
  status: success
  attempts: 0
  max_attempts: 1
  depends_on:
  - S1-PROXMOX-INVENTORY-PLANNER-RECOVERY
  note: Executor succeeded
- id: S1-PROXMOX-INVENTORY-DELETE
  stage: 1
  persona: executor
  summary: 'DELETE/RESET: clear partial state for S1-PROXMOX-INVENTORY'
  detail: Explicit reset to clear partial state before re-apply
  target: infrastructure/proxmox/wipe_proxmox.sh
  status: success
  attempts: 0
  max_attempts: 1
  depends_on:
  - S1-PROXMOX-INVENTORY-RECONCILE
  note: Executor succeeded
- id: S1-PROXMOX-INVENTORY-APPLY-RETRY
  stage: 1
  persona: executor
  summary: 'APPLY: rebuild after S1-PROXMOX-INVENTORY'
  detail: Re-apply desired state from clean baseline
  target: infrastructure/proxmox/cluster_bootstrap.sh
  status: blocked
  attempts: 3
  max_attempts: 3
  depends_on:
  - S1-PROXMOX-INVENTORY-DELETE
  note: 'Blocked: VM provisioning queued (stage S1)'
  metadata:
    blocked_mode: recovery
    classification: ERR_PREREQ_MISSING_VMS
- id: S1-PROXMOX-INVENTORY-VALIDATE-RETRY
  stage: 1
  persona: executor
  summary: 'VALIDATE: confirm recovery for S1-PROXMOX-INVENTORY'
  detail: Verify rebuilt state after recovery apply
  target: infrastructure/proxmox/check_cluster.sh
  status: pending
  attempts: 0
  max_attempts: 3
  depends_on:
  - S1-PROXMOX-INVENTORY-APPLY-RETRY
- id: S1-PLANNER-DEADLOCK-c8890b81
  stage: 1
  persona: planner
  summary: Deadlock recovery for stage 1
  detail: 'Deadlock detected: S1-APPLY-BOOTSTRAP blocked_by S1-RESOLVE-CTRL_IP; S1-PROVISION-VMS
    blocked_by S1-PROXMOX-INVENTORY; S1-PROXMOX-INVENTORY-VALIDATE-RETRY blocked_by
    S1-PROXMOX-INVENTORY-APPLY-RETRY; S1-RESOLVE-CTRL_IP blocked_by S1-PROVISION-VMS;
    S1-VALIDATE-BOOTSTRAP blocked_by S1-APPLY-BOOTSTRAP. top_blocker=S1-PROVISION-VMS
    blocked_by S1-PROXMOX-INVENTORY (status=blocked note=Blocked after 1 failures
    (recovery queued)). signature=c8890b81a47c547082a120b98dda90fa49631ac5ce6b78adf94cb52b869f8ff2'
  target: docs/orchestrator_v7_2.txt
  attempts: 0
  max_attempts: 1
  status: success
  note: No additional work needed at this time
  depends_on: []
