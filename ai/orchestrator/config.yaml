# Stage 1 orchestrator persona routing
personas:
  executor:
    description: "Level-1 worker; runs commands and small file edits."
    primary_model: executor_local
    fallback_model: executor_cloud
    max_context_tokens: 1024
    max_output_tokens: 256
    allowed_paths:
      - cluster/
      - config/
      - scripts/
      - docs/
      - ai/
    forbidden_paths:
      - .git/
      - .talos/
      - /etc/
      - /var/
    max_retries: 3

  engineer:
    description: "Debugger/fixer; edits infra scripts and complex code."
    primary_model: engineer_default
    max_context_tokens: 4096
    max_output_tokens: 1024
    allowed_paths:
      - cluster/
      - infrastructure/
      - config/
      - scripts/
      - docs/
      - ai/
    forbidden_paths:
      - .git/
      - /etc/
      - /var/
    can_edit_infra: true
    can_edit_orchestrator: true

  planner:
    description: "Planner/designer; sets repo contracts and task strategies."
    primary_model: planner_default
    max_context_tokens: 8192
    max_output_tokens: 2048
    allowed_paths:
      - docs/
      - ai/
    auto_approve_paths:
      - docs/
      - ai/
    can_edit_code: false
    can_edit_backlog_structure: true
    can_edit_persona_config: true

routing:
  default_persona: executor

  escalation_rules:
    - from: executor
      to: engineer
      on:
        failure_count: 3
        same_error_pattern: true
      create_backlog_task: true
      backlog_type: code_fix

    - from: engineer
      to: planner
      on:
        needs_architecture_change: true
        or_manual_flag: true
