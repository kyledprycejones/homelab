# Contributing & AI Workflow

This repo is orchestrated by both humans and AI agents (Architect/Junior/Hands). To keep `main` stable we follow a predictable Git + directory workflow.

## Canonical branch
- `main` is the default branch on GitHub. Always `git fetch --all --prune` and `git checkout main && git pull` before branching.

## Branch naming
- Every automation/AI branch must use: `ai/<short-purpose>-<yyyymmdd>`
  - Examples: `ai/cloudflared-20251127`, `ai/monitoring-dashboards-20251201`
- Base the branch on `main`. No more `codex*`, `test`, or random names.

## Allowed vs. forbidden directories
| Allowed for AI edits | Notes |
| --- | --- |
| `ai/**` | mission, backlog, prompts, studio workflows |
| `infra/flux/**`, `infra/k8s/**` | GitOps manifests; ConfigMaps like `cloudflared` are AI-editable |
| `prox/**`, `scripts/**` | Bootstrap + helper scripts (small, scoped edits only) |
| `docs/**`, `ui/logs/**` | Documentation + static viewers |
| `logs/` | runtime output (gitignored) |

| Forbidden / human-only | Reason |
| --- | --- |
| `config/env/**` (except `.env.example`) | Contains real secrets; never commit or read |
| Kubernetes Secrets / tokens (e.g., `cloudflared-token`) | Generated by bootstrap scripts |
| `infra/k8s/cloudflared/deployment.yaml`, destructive manifests | Human-owned architecture |
| DNS / Cloudflare CLI tooling | Managed manually or via human-run scripts |

## Workflow steps
1. **Sync main**  
   ```bash
   git fetch --all --prune
   git checkout main
   git pull origin main
   ```
2. **Branch**  
   ```bash
   git checkout -b ai/<slug>-<yyyymmdd>
   ```
3. **Change** – edit only within the mission-approved directories (Stage 1 vs Stage 2) and obey the config/env guardrail.
4. **Test / validate** – run harnesses or lint as needed.
5. **Commit** – small, descriptive commits (e.g., `git commit -m "cloudflared: add grafana route"`).
6. **Push & PR**  
   ```bash
   git push -u origin ai/<slug>-<yyyymmdd>
   ```
   Open a PR into `main` with a short summary and list of changes.
7. **Review / Merge** – Human (or approved automation) reviews and merges into `main`.

Following this playbook keeps secrets out of Git, ensures the AI only edits safe files, and gives us a consistent history for future orchestrator runs.
